<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SceneCraft AI – Scene Editor</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="flex flex-col min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-black text-gray-100">

  <!-- Header -->
  <header class="bg-gray-900/90 backdrop-blur sticky top-0 z-20">
    <div class="max-w-5xl mx-auto flex items-center p-4">
      <a href="/" class="text-3xl font-extrabold text-yellow-400 mr-8">SceneCraft AI</a>
      <nav class="flex space-x-6 flex-1 text-lg">
        <a href="/"          class="hover:text-yellow-300">Scene Analyzer</a>
        <a href="editor.html" class="text-yellow-300 border-b-2 border-yellow-300 pb-1">Scene Editor</a>
        <a href="#"          class="hover:text-yellow-300">Full Script Writer</a>
        <a href="#"          class="hover:text-yellow-300">How it Works</a>
        <a href="#"          class="hover:text-yellow-300">Pricing</a>
      </nav>
      <button class="ml-8 bg-yellow-400 text-gray-900 py-2 px-4 rounded-lg whitespace-nowrap">
        Log In / Sign Up
      </button>
    </div>
  </header>

  <main class="flex-grow">

    <section class="p-6 max-w-5xl mx-auto space-y-6">
      <h1 class="text-4xl font-extrabold text-yellow-400 text-center">SceneCraft AI – Scene Editor</h1>
    </section>

    <section class="p-6 max-w-4xl mx-auto bg-gray-900/80 rounded-lg space-y-4 mt-4">
      <textarea
        id="sceneInputEditor"
        rows="10"
        class="w-full p-4 bg-gray-800 rounded text-gray-100"
        placeholder="Paste your scene (up to 2 pages)..."
      ></textarea>

      <div class="flex items-center space-x-4">
        <input type="file" id="sceneFileEditor" accept=".txt,.pdf" class="text-gray-400"/>
        <label class="inline-flex items-center text-gray-200">
          <input type="checkbox" id="agreeChkEditor" class="form-checkbox text-yellow-400"/>
          <span>I agree to 
            <a href="/terms" target="_blank" class="underline text-yellow-300 hover:text-yellow-400">Terms & Conditions</a>
          </span>
        </label>
      </div>

      <button id="editBtn" class="w-full bg-yellow-400 text-gray-900 py-3 rounded-lg font-semibold">
        Edit Scene
      </button>

      <div id="editOutput" class="hidden bg-gray-800 p-6 rounded-lg mt-6">
        <h3 class="font-semibold text-yellow-300 mb-4">Rewrite Suggestions</h3>
        <div id="editResult" class="text-gray-100 space-y-4"></div>
      </div>
    </section>

  </main>

  <script>
    document.getElementById('editBtn').onclick = () => {
      const agree = document.getElementById('agreeChkEditor').checked;
      const txtArea = document.getElementById('sceneInputEditor');
      const fileIn  = document.getElementById('sceneFileEditor');

      if (!agree) {
        alert('Please accept the Terms & Conditions.');
        return;
      }
      if (!txtArea.value.trim() && fileIn.files.length) {
        return fileIn.files[0].text().then(t => doEdit(t.trim()));
      }
      doEdit(txtArea.value.trim());
    };

    function doEdit(scene) {
      if (scene.length < 10) {
        alert('Enter at least 10 characters.');
        return;
      }

      const out = document.getElementById('editOutput');
      const res = document.getElementById('editResult');
      res.innerText = 'Editing...';
      out.classList.remove('hidden');

      fetch('/editor/analyze', {
        method: 'POST',
        credentials: 'include',           // <— include Basic‑Auth credentials
        headers: {
          'Content-Type': 'application/json',
          'x-user-agreement': 'true'
        },
        body: JSON.stringify({ scene })
      })
      .then(r => r.json())
      .then(d => {
        // show cleaned + analysis
        res.innerHTML = '';
        if (d.cleaned_scene) {
          const pre = document.createElement('pre');
          pre.className = 'bg-gray-800 p-4 rounded mb-4 text-gray-100';
          pre.textContent = d.cleaned_scene;
          res.appendChild(pre);
        }
        d.analysis.split('\n\n').forEach(p => {
          const pEl = document.createElement('p');
          pEl.className = 'mb-4';
          pEl.innerText = p;
          res.appendChild(pEl);
        });
      })
      .catch(e => {
        document.getElementById('editResult').innerText = 'Network error: ' + e.message;
      });
    }
  </script>
</body>
</html>
